/*!
 * jQuery ClassyPicozu
 * www.class.pm
 *
 * Written by Marius Stanciu - Sergiu <marius@class.pm>
 * Licensed under the MIT license www.class.pm/LICENSE-MIT
 * Version 1.0.1
 *
 */(function(c,p,m){c.extend(c.easing,{easeOutBackMin:function(a,b,c,e,f,g){g=1;return e*((b=b/f-1)*b*((g+1)*b+g)+1)+c}});c.extend({ClassyPicozu:{defaults:{style:{zIndex:99999,width:1100,height:768},overlay:{opacity:0.6},animation:{show:{duration:400,easing:"easeOutBackMin"},close:{duration:200,easing:"easeOutBackMin"},move:{duration:700,easing:"easeOutBackMin"}},iframe:{width:1100,height:768},maxSize:{width:-1,height:-1},from:"top"},options:{},animations:{},image:{},template:{lightbox:[],background:[], image:[],html:[]},visible:!1,maximized:!1,mode:"iframe",overlay:{_create:function(a){this.options=a;this.element=c('<div id="'+(new Date).getTime()+'" class="picozu-lightbox-overlay"></div>');this.element.css(c.extend({},{position:"fixed",top:0,left:0,opacity:0,display:"none","z-index":this.options.zIndex},this.options.style));this.hidden=!0;this._build();return this},_build:function(){this.target=c(m.body);this.target.append(this.element)},_resize:function(a,b){this.element.css({height:0,width:0}); this.shim&&this.shim.css({height:0,width:0});c(m).width();var d=c(m).height();this.element.css({width:"100%",height:b||d});this.shim&&(this.shim.css({height:0,width:0}),this.shim.css({position:"absolute",left:0,top:0,width:this.element.width(),height:b||d}));return this},show:function(a){if(!this.hidden)return this;this.transition&&this.transition.stop();this.shim&&this.shim.css("display","block");this.element.css({display:"block",opacity:0});this._resize();this.hidden=!1;this.transition=this.element.fadeTo(this.options.showDuration, this.options.style.opacity,c.proxy(function(){this.options.style.opacity&&this.element.css(this.options.style);this.element.trigger("show");c.isFunction(a)&&a()},this));return this},hide:function(a){if(this.hidden)return this;this.transition&&this.transition.stop();this.shim&&this.shim.css("display","none");this.hidden=!0;this.transition=this.element.fadeTo(this.options.closeDuration,0,c.proxy(function(){this.element.trigger("hide");c.isFunction(a)&&a();this.element.css({height:0,width:0,display:"none"})}, this));return this}},_create:function(a){this.options=c.extend(!0,this.defaults,a);a=c('<div class="picozu-lightbox mode-image"><a class="close" href="#close"><span>close</span></a><div class="background"><span class="loader"><span class="left"><span class="anim"></span></span><span class="right"><span class="anim"></span></span></span></div><div class="picozu-lightbox-html"></div></div>');var b=this.template;this.overlay._create({style:this.options.overlay,zIndex:this.options.style.zIndex-1,callback:this.proxy(this.close), showDuration:this.options.animation.show.duration,closeDuration:this.options.animation.close.duration});b.lightbox=a;b.background=c(".background",a);b.html=c(".picozu-lightbox-html",a);b.move=c('<div class="picozu-lightbox-move"></div>').css({position:"absolute","z-index":this.options.style.zIndex,top:-999}).append(a);c("body").append(b.move);this.win=c(p);this._setupEvents();return a},_setupEvents:function(){this.win[0].onorientationchange=function(){this.visible&&(this.overlay._resize(),this.move&& !this.maximized&&this._move())};this.win.bind("resize",this.proxy(function(){this.visible&&(this.overlay._resize(),this.move&&!this.maximized&&this._move())}));this.win.bind("scroll",this.proxy(function(){this.visible&&this.move&&!this.maximized&&this._move()}));c(".picozu-lightbox .close").bind("click touchend",{fn:"close"},this.proxy(this.fn));this.overlay.element.bind("show",this.proxy(function(){c(this).triggerHandler("show")}));this.overlay.element.bind("hide",this.proxy(function(){c(this).triggerHandler("close")}))}, fn:function(a){this[a.data.fn].apply(this);a.preventDefault()},proxy:function(a){return c.proxy(a,this)},show:function(a,b,d){if(this.isEmpty(a))return!1;var e=this.win.width(),f=this.win.height(),g=a[0],h=!1;a=g.href;this._setupLoading();h=this.visible;this.open();!1===h&&this._move();b=c.extend(!0,{width:1100,height:768,move:!0,key:null,image:null,expand:"right",theme:"default",workspace:1,onOpen:function(){},onClose:function(){}},b||{},g);this.options.onOpen=b.onOpen;this.options.onClose=b.onClose; b.width&&0<(""+b.width).indexOf("p")&&(b.width=Math.round((e-20)*b.width.substring(0,b.width.indexOf("p"))/100));b.height&&0<(""+b.height).indexOf("p")&&(b.height=Math.round((f-20)*b.height.substring(0,b.height.indexOf("p"))/100));this.move=!!b.move;this.maximized=!1;if(""===b.key||null===b.key)return this.error("You have to specify the Picozu API key."),!1;null!==b.image&&""!==b.image&&(a=b.image);if(b.width)e=b.width,f=b.height;else return this.error("You have to specify the modal window size."), !1;b='<iframe id="IF_'+(new Date).getTime()+'" frameborder="0" src="https://www.picozu.com/editor/?i='+encodeURIComponent(window.btoa(a))+"&amp;key="+b.key+"&amp;theme="+b.theme+"&amp;workspace="+b.workspace+'" style="margin:0; padding:0;"></iframe>';this._setupHTML(c(b).css({width:e,height:f}),e,f);this.callback=c.isFunction(d)?d:function(b){}},_setupHTML:function(a,b,c){var e=this.options,f=this.template,g=f.background;this._setupMode("html");this._resize(b,c+20);g.bind("complete",function(){f.html.append(a); g.unbind("complete");e.onOpen.apply(this)})},_move:function(a,b){var d=c(this.win),e=this.template,f=null!=a?a:e.lightbox.outerWidth(!0),g=null!=b?b:e.lightbox.outerHeight(!0),h=0,k=0,n=d.width(),l=d.height(),k=d.scrollLeft(),d=d.scrollTop(),k=k+(n-f)/2;this.visible?h=d+(l-g)/2:"bottom"===this.options.from?h=d+l:"top"===this.options.from?h=d-g:"right"===this.options.from?(k=n,h=d+(l-g)/2):"left"===this.options.from&&(k=-f,h=d+(l-g)/2);this.visible?(this.animations.move||this._morph(e.move,{left:parseInt(k, 10)},"move"),this._morph(e.move,{top:parseInt(h,10)},"move")):e.move.css({left:parseInt(k,10),top:parseInt(h,10)})},_morph:function(a,b,d,e,f){a.animate(b,{queue:f||!1,duration:this.options.animation[d].duration,easing:this.options.animation[d].easing,complete:c.isFunction(e)?this.proxy(e,this):null})},_resize:function(a,b){var d=this.template;if(this.visible){var e=c(this.win).width(),f=c(this.win).height(),g=c(this.win).scrollLeft(),h=c(this.win).scrollTop(),e=Math.max(g+(e-a)/2,0),g=Math.max(h+ (f-b)/2,0);this.animations.move=!0;this._morph(d.move.stop(),{left:this.maximized&&0>e?0:e,top:this.maximized&&b>f?h:g},"move",c.proxy(function(){this.move=!1},this.animations));this._morph(d.html,{height:b-20},"move");this._morph(d.lightbox.stop(),{width:a,height:b-20},"move",{},!0);this._morph(d.background.stop(),{width:a,height:b-20},"move",function(){c(d.background).trigger("complete")})}else d.html.css({height:b-20}),d.lightbox.css({width:a,height:b-20}),d.background.css({width:a,height:b})}, close:function(a){var b=this.template;this.visible=!1;this.options.onClose();b.move.animate({opacity:0,top:"-=40"},{queue:!1,complete:this.proxy(function(){b.background.empty();b.html.empty();this._move();b.move.css({display:"none",opacity:1,overflow:"visible"})})});this.overlay.hide(this.proxy(function(){c.isFunction(this.callback)&&this.callback.apply(this,c.makeArray(a))}));b.background.stop(!0,!1).unbind("complete")},open:function(){this.visible=!0;this.template.move.stop().css({opacity:1,display:"block", overflow:"visible"}).show();this.overlay.show()},_setupMode:function(a){a!==this.mode&&(this.template.lightbox.removeClass("mode-"+this.mode).addClass("mode-"+a),this.mode=a);this.template.move.css("overflow","visible")},error:function(a){alert(a);this.close()},_calc:function(a,b){var c=0<this.options.maxSize.width?this.options.maxSize.width:this.win.width()-50,e=0<this.options.maxSize.height?this.options.maxSize.height:this.win.height()-50;a>c?(b*=c/a,a=c,b>e&&(a*=e/b,b=e)):b>e&&(a*=e/b,b=e,a>c&& (b*=c/a,a=c));return{width:parseInt(a,10),height:parseInt(b,10)}},_setupLoading:function(){var a=this.options.style,b=this.template,c=b.background;this._setupMode("image");c.children().stop(!0);b.html.empty();!1===this.visible&&(this._move(a.width,a.height),this._resize(a.width,a.height))},getOptions:function(a){a=c(a);return c.extend({},{href:a.attr("href"),rel:c.trim(a.attr("data-rel")||a.attr("rel")),relent:a.attr("data-rel")?"data-rel":"rel",element:a[0]},c.parseJSON((a.attr("data-options")|| "{}").replace(/\'/g,'"'))||{})},link:function(a,b){var d=c(b.element),e=this.getOptions(d),f=e.rel,g=e.relent,h=b.options,k=[];d.blur();if(this.isEmpty(f)||"nofollow"===f)k=[e];else{var n=[],l=[],m=!1;c("a["+g+"], area["+g+"]",this.ownerDocument).filter("["+g+'="'+f+'"]').each(c.proxy(function(b,a){d[0]===a?(n.unshift(this.getOptions(a)),m=!0):!1===m?l.push(this.getOptions(a)):n.push(this.getOptions(a))},this));k=n.concat(l)}c.lightbox(k,h,b.callback,d);return!1},isEmpty:function(a){if(null==a)return!0; if("[object String]"===Object.prototype.toString.call(a)||"array"===c.type(a))return 0===a.length}},lightbox:function(a,b,d){var e=[];if(c.ClassyPicozu.isEmpty(a))return c.ClassyPicozu;for(var f=0;f<a.length;f++)e[f]=c.extend({},b,a[f]);return c.ClassyPicozu.show(e,b,d)}});c.fn.ClassyPicozu=function(a,b){return c(this).on("click",function(d){d.preventDefault();d.stopImmediatePropagation();return c.proxy(c.ClassyPicozu.link,c.ClassyPicozu)(d,c.extend({},{selector:this.selector,options:a,callback:b}, {element:this}))})};c(function(){c.ClassyPicozu._create()})})(jQuery,window,document);