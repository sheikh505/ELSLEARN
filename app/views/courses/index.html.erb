<%= link_to "Manage Courses", "/courses/manage_courses", remote: true, id: "course_link", class: "btn btn-primary" %> |
<%= link_to "Course Linkings", "/course_linkings", remote: true, id: "course_linking_link", class: "btn btn-primary" %>

<div id="course_container">
  <h1>Listing courses</h1>
  <%= label_tag :select_certification %>
  <%= select_tag "degree", options_from_collection_for_select(@degrees, :id, :name) %>
  <div class="listing-holder">
    <table class="table table-condensed">
      <thead>
      <tr>
        <th>Name</th>
        <th>Certification  ( Board )</th>
        <th></th>
        <th></th>
      </tr>
      </thead>
      <tbody>
      <% @degree_hash.each do |k,v| %>
          <tr>
            <td><%= k.split("::").last  %></td>
            <td>

              <%v.each_with_index do |bdgree, index| %>
                  <% if index == v.size - 1 %>
                      <%= bdgree.board.name + "(" + bdgree.degree.name + ")" %>
                  <% else %>
                      <%= bdgree.board.name + "(" + bdgree.degree.name + "), " %>
                  <% end %>
              <% end %>



            </td>
            <% if can? :update, Course %>
                <td><%= link_to 'Edit', edit_course_path(k.split("-").first.to_i), class: "edit_course", remote: true %></td>
            <% else %>
                <td></td>
            <% end %>
            <% if can? :update, Course %>
                <td><%= link_to 'Delete',course_path(k.split("-").first.to_i), method: :delete, remote: true,
                                class: "delete_course", data: { confirm: 'Are you sure?' } %></td>
            <% else %>
                <td></td>
            <% end %>


          </tr>
      <% end %>
      </tbody>
    </table>
  </div>

  <% if can? :manage, Course %>
      <%= link_to 'New Course', new_course_path, id: "new_course", remote: true, :class=> 'btn btn-large btn-inverse' %>
  <% end %>
</div>

<script>
  $('#course_link').on("ajax:success", function(e, data, status, xhr){
    $('#course_container').html(data);
  });

  $('#course_linking_link').on("ajax:success", function(e, data, status, xhr){
    $('#course_container').html(data);
  });

  $('#new_course').on("ajax:success", function(e, data, status, xhr){
    $('#course_container').html(data);
  });

  $('.delete_course').on("ajax:success", function(e, data, status, xhr){
    $('#course_container').html(data);
    $( "<br><div id='error' class='alert alert-danger'> <strong>Course successfully deleted.</strong> </div>" ).insertAfter( "h1" );
    $('#error').fadeIn(700).focus().delay(2500).fadeOut(800);
  });

  $('.edit_course').on("ajax:success", function(e, data, status, xhr){
    $('#course_container').html(data);
  });

  $('#degree').on("change", function(){
    degree_id = $('#degree').val();
    $.ajax({
      url: "/courses/fetch_courses?degree_id=" + degree_id,
      success: function(data){
        $('.listing-holder').html(data);
      }
    })
  });
</script>